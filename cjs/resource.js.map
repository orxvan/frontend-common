{"version":3,"file":"resource.js","sources":["../../src/resource.js"],"sourcesContent":["// @flow\n\nimport axios from 'axios'\nimport type { Axios } from 'axios'\nimport debug from 'debug'\nimport * as R from 'ramda'\n\ntype EndpointImpl = () => Promise<mixed>\n\ntype Endpoint = {\n  name: string,\n  impl: EndpointImpl,\n}\n\ntype Config = {\n  baseURL: string,\n  endpoints: { [key: string]: Endpoint },\n  http: Axios,\n}\n\ntype Builder = Config => Config\ntype Resource = { [key: string]: EndpointImpl }\n\nconst log = debug('ein:common:resource')\n\nconst normalizeURL = R.pipe(\n  R.replace(/\\/+$/, ''), // remove trailing\n  R.replace(/^/, '/'), // prepend\n  R.replace(/\\/+/g, '/') // remove duplicates\n)\n\nconst withBaseURL = (url: string = '/') => R.assoc('baseURL', normalizeURL(url))\n\nconst defineEndpoint = (name: string, makeImpl: Config => EndpointImpl) => (\n  config: Config\n) => R.assocPath(['endpoints', name], { name, impl: makeImpl(config) }, config)\n\n// TODO: allow custom param validations\nconst methods = {\n  list: () =>\n    defineEndpoint('list', ({ baseURL, http }) => async (params = {}) => {\n      const resp = await http.get(`${baseURL}/`, { params })\n      return resp.data\n    }),\n\n  create: () =>\n    defineEndpoint('create', ({ baseURL, http }) => async (data = {}) => {\n      const resp = await http.post(`${baseURL}/`, data)\n      return resp.data\n    }),\n\n  get: () =>\n    defineEndpoint('get', ({ baseURL, http }) => async id => {\n      const resp = await http.get(`${baseURL}/${String(id)}`)\n      return resp.data\n    }),\n\n  update: () =>\n    defineEndpoint('update', ({ baseURL, http }) => async (id, data) => {\n      const resp = await http.put(`${baseURL}/${String(id)}`, data)\n      return resp.data\n    }),\n\n  delete: () =>\n    defineEndpoint('delete', ({ baseURL, http }) => async id => {\n      await http.delete(`${baseURL}/${String(id)}`)\n      return true\n    }),\n\n  custom: defineEndpoint,\n}\n\nconst withHttp = (client: Axios) => R.assoc('http', client)\n\nconst DEFAULT_CONFIG: Config = {\n  baseURL: '/',\n  endpoints: {},\n  http: axios.create({\n    headers: { 'Content-Type': 'application/json' },\n  }),\n}\n\nconst defineResourceMethod = (resource: Resource, endpoint: Endpoint) =>\n  R.assoc(endpoint.name, endpoint.impl, resource)\n\nconst defineResource: (Array<Builder>) => Resource = R.pipe(\n  R.reduce((config, builder) => builder(config), DEFAULT_CONFIG),\n  R.tap(config => log('defineResource:', config)),\n  R.prop('endpoints'),\n  R.values,\n  R.reduce(defineResourceMethod, {})\n)\n\nexport { methods, defineResource, withBaseURL, withHttp }\n"],"names":["log","debug","normalizeURL","R","withBaseURL","url","defineEndpoint","name","makeImpl","config","impl","methods","baseURL","http","params","get","resp","data","post","id","String","put","delete","withHttp","client","DEFAULT_CONFIG","axios","create","defineResourceMethod","resource","endpoint","defineResource","builder"],"mappings":"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"}