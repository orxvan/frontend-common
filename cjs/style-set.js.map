{"version":3,"file":"style-set.js","sources":["../../src/style-set.js"],"sourcesContent":["// @flow\n\nimport debug from 'debug'\nimport * as R from 'ramda'\n\nimport { isNilOrEmpty } from './ramda-extra'\n\ntype CSSModule = {\n  [key: string]: string,\n}\n\ntype SimpleModifier = string | Symbol | null | typeof undefined\n\n// flowlint-next-line unclear-type:off\ntype Modifier = SimpleModifier | Array<SimpleModifier> | Object\n\ntype ReduceAcc = {\n  globals: Array<string>,\n  locals: Array<string>,\n}\n\nconst log = debug('ein:common:style-set')\n\nconst isSymbol = (value: mixed): boolean =>\n  R.is(Symbol, value) || R.type(value) === 'Symbol'\n\nconst symbolToString = R.pipe(R.toString, R.slice('Symbol('.length, -1))\nconst extractTruthyKeys = R.pipe(R.filter(v => !!v), R.keys)\n\nconst isBlank = R.cond([\n  [R.is(String), s => R.isEmpty(s.trim())],\n  [R.T, isNilOrEmpty],\n])\n\nconst rejectBlank = R.reject(isBlank)\n\nclass StyleSet {\n  blockName: string\n  styles: CSSModule\n\n  static flattenClasses(classes: Array<Modifier>): Array<string> {\n    let rv: Array<string> = []\n\n    for (const name of classes) {\n      if (typeof name === 'string') {\n        rv.push(name)\n      } else if (isSymbol(name)) {\n        rv.push(symbolToString(name))\n      } else if (Array.isArray(name)) {\n        const xs = name.map(s => (isSymbol(s) ? symbolToString(s) : String(s)))\n        rv = R.concat(rv, xs)\n      } else if (R.is(Object, name) && !!name) {\n        rv = R.concat(rv, extractTruthyKeys(name))\n      }\n    }\n\n    return rv\n  }\n\n  static join(...args: Array<Modifier>): string {\n    return R.pipe(StyleSet.flattenClasses, rejectBlank, R.join(' '))(args)\n  }\n\n  constructor(blockName: string, styles: CSSModule) {\n    this.blockName = blockName\n    this.styles = styles\n  }\n\n  block(...args: Array<Modifier>): string {\n    return this._join({ args, baseName: this.blockName })\n  }\n\n  elem(name: string, ...args: Array<Modifier>): string {\n    return this._join({ args, baseName: `${this.blockName}__${name}` })\n  }\n\n  _lookup(name) {\n    if (!(name in this.styles)) {\n      log('unknown class name:', name)\n    }\n    return this.styles[name] || ''\n  }\n\n  _getReducer(baseName) {\n    const prefix = baseName.length > 0 ? `${baseName}--` : ''\n\n    return (acc: ReduceAcc, arg: string) => {\n      const name = `${prefix}${arg}`\n\n      if (arg.startsWith('!')) {\n        acc.globals.push(arg.slice(1))\n      } else {\n        acc.locals.push(this._lookup(name))\n      }\n\n      return acc\n    }\n  }\n\n  _join({ args = [], baseName = '' }) {\n    const { globals, locals } = R.pipe(\n      StyleSet.flattenClasses,\n      rejectBlank,\n      R.reduce(this._getReducer(baseName), {\n        globals: [],\n        locals: [this._lookup(baseName)],\n      })\n    )(args)\n\n    return rejectBlank(globals.concat(locals)).join(' ')\n  }\n}\n\nexport default StyleSet\n"],"names":["log","debug","isSymbol","value","R","symbolToString","length","extractTruthyKeys","v","isBlank","String","s","trim","isNilOrEmpty","rejectBlank","StyleSet","classes","rv","name","push","Array","isArray","xs","map","Object","args","flattenClasses","blockName","styles","_join","baseName","prefix","acc","arg","startsWith","globals","slice","locals","_lookup","_getReducer","concat","join"],"mappings":"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"}