{"version":3,"file":"resource.js","sources":["../../src/resource.js"],"sourcesContent":["import axios from 'axios'\nimport debug from 'debug'\nimport * as R from 'ramda'\n\nconst isFunction = R.is(Function)\nconst log = debug('ein:common:resource')\n\nconst normalizeURL = R.pipe(\n  R.replace(/\\/+$/, ''), // remove trailing\n  R.replace(/^/, '/'), // prepend\n  R.replace(/\\/+/g, '/') // remove duplicates\n)\n\nconst withBaseURL = (url = '/') => R.assoc('baseURL', normalizeURL(url))\n\nconst defineEndpoint = (name, makeImpl) => config =>\n  R.assocPath(['endpoints', name], { name, impl: makeImpl(config) }, config)\n\nconst selectResponse = (selector, { data }) =>\n  isFunction(selector) ? selector(data) : data\n\n// TODO: allow custom param validations\nconst methods = {\n  list: (options = {}) =>\n    defineEndpoint('list', ({ baseURL, http }) => async (params = {}) => {\n      const resp = await http.get(`${baseURL}/`, { params })\n      return selectResponse(options.selector, resp)\n    }),\n\n  create: (options = {}) =>\n    defineEndpoint('create', ({ baseURL, http }) => async (data = {}) => {\n      const resp = await http.post(`${baseURL}/`, data)\n      return selectResponse(options.selector, resp)\n    }),\n\n  get: (options = {}) =>\n    defineEndpoint('get', ({ baseURL, http }) => async id => {\n      const resp = await http.get(`${baseURL}/${id}`)\n      return selectResponse(options.selector, resp)\n    }),\n\n  update: (options = {}) =>\n    defineEndpoint('update', ({ baseURL, http }) => async (id, data) => {\n      const resp = await http.put(`${baseURL}/${id}`, data)\n      return selectResponse(options.selector, resp)\n    }),\n\n  delete: () =>\n    defineEndpoint('delete', ({ baseURL, http }) => async id => {\n      await http.delete(`${baseURL}/${id}`)\n      return true\n    }),\n\n  custom: defineEndpoint,\n}\n\nconst withHttp = client => R.assoc('http', client)\n\nconst DEFAULT_OPTIONS = {\n  baseURL: '/',\n  endpoints: {},\n  http: axios.create({\n    headers: { 'Content-Type': 'application/json' },\n  }),\n}\n\nconst defineResourceMethod = (resource, endpoint) =>\n  R.assoc(endpoint.name, endpoint.impl, resource)\n\nconst defineResource = R.pipe(\n  R.reduce((config, builder) => builder(config), DEFAULT_OPTIONS),\n  R.tap(config => log('defineResource:', config)),\n  R.prop('endpoints'),\n  R.values,\n  R.reduce(defineResourceMethod, {})\n)\n\nexport { methods, defineResource, withBaseURL, withHttp }\n"],"names":["isFunction","R","Function","log","debug","normalizeURL","withBaseURL","url","defineEndpoint","name","makeImpl","impl","config","selectResponse","selector","data","methods","options","baseURL","http","params","get","resp","post","id","put","delete","withHttp","client","DEFAULT_OPTIONS","axios","create","defineResourceMethod","resource","endpoint","defineResource","builder"],"mappings":"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"}