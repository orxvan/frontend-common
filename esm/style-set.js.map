{"version":3,"file":"style-set.js","sources":["../../src/style-set.js"],"sourcesContent":["import debug from 'debug'\nimport * as R from 'ramda'\n\nconst { is, isEmpty } = R\nconst log = debug('ein:common:style-set')\n\nconst isSymbol = R.either(R.is(Symbol), R.pipe(R.type, R.equals('Symbol')))\n\nconst isBlank = R.cond([\n  [is(String), s => isEmpty(s.trim())],\n  [R.T, R.either(isEmpty, R.isNil)],\n])\n\nconst rejectBlank = R.reject(isBlank)\n\nexport default class StyleSet {\n  constructor(blockName, styles) {\n    this.blockName = blockName\n    this.styles = styles\n  }\n\n  block(...args) {\n    return this._join({ args, baseName: this.blockName })\n  }\n\n  elem(name, ...args) {\n    return this._join({ args, baseName: `${this.blockName}__${name}` })\n  }\n\n  _lookup(name) {\n    if (!(name in this.styles)) {\n      log('unknown class name:', name)\n    }\n    return this.styles[name] || ''\n  }\n\n  _getReducer(baseName) {\n    const prefix = baseName.length > 0 ? `${baseName}--` : ''\n\n    return (acc, arg) => {\n      const name = `${prefix}${arg}`\n\n      if (arg.startsWith('!')) {\n        acc.globals.push(arg.slice(1))\n      } else {\n        acc.locals.push(this._lookup(name))\n      }\n\n      return acc\n    }\n  }\n\n  _join({ args = [], baseName = '' }) {\n    const { globals, locals } = R.pipe(\n      StyleSet.flattenClasses,\n      rejectBlank,\n      R.reduce(this._getReducer(baseName), {\n        globals: [],\n        locals: [this._lookup(baseName)],\n      })\n    )(args)\n\n    return rejectBlank(globals.concat(locals)).join(' ')\n  }\n}\n\nStyleSet.flattenClasses = R.chain(\n  R.cond([\n    [is(String), R.identity],\n    [isSymbol, R.pipe(R.toString, R.slice('Symbol('.length, -1))],\n    [is(Array), R.identity],\n    [is(Object), R.pipe(R.filter(R.identity), R.keys)],\n  ])\n)\n\nStyleSet.join = R.unapply(\n  R.pipe(StyleSet.flattenClasses, rejectBlank, R.join(' '))\n)\n"],"names":["is","R","isEmpty","log","debug","isSymbol","isBlank","String","s","trim","rejectBlank","StyleSet","blockName","styles","args","_join","baseName","name","prefix","length","acc","arg","startsWith","globals","push","slice","locals","_lookup","flattenClasses","_getReducer","concat","join","Array","Object"],"mappings":";;;;;;IAGQA,OAAgBC;IAAZC,YAAYD;;AACxB,IAAME,MAAMC,MAAM,sBAAN,CAAZ;;AAEA,IAAMC,WAAWJ,MAAA,CAASA,EAAA,SAAT,EAAuBA,IAAA,CAAOA,IAAP,EAAeA,MAAA,CAAS,QAAT,CAAf,CAAvB,CAAjB;;AAEA,IAAMK,UAAUL,IAAA,CAAO,CACrB,CAACD,KAAGO,MAAH,CAAD,EAAa;SAAKL,UAAQM,EAAEC,IAAF,EAAR,CAAL;CAAb,CADqB,EAErB,CAACR,CAAD,EAAMA,MAAA,CAASC,SAAT,EAAkBD,KAAlB,CAAN,CAFqB,CAAP,CAAhB;;AAKA,IAAMS,cAAcT,MAAA,CAASK,OAAT,CAApB;;IAEqBK;oBACPC,SAAZ,EAAuBC,MAAvB,EAA+B;;;SACxBD,SAAL,GAAiBA,SAAjB;SACKC,MAAL,GAAcA,MAAd;;;;;4BAGa;wCAANC,IAAM;YAAA;;;aACN,KAAKC,KAAL,CAAW,EAAED,UAAF,EAAQE,UAAU,KAAKJ,SAAvB,EAAX,CAAP;;;;yBAGGK,MAAe;yCAANH,IAAM;YAAA;;;aACX,KAAKC,KAAL,CAAW,EAAED,UAAF,EAAQE,UAAa,KAAKJ,SAAlB,UAAgCK,IAAxC,EAAX,CAAP;;;;4BAGMA,MAAM;UACR,EAAEA,QAAQ,KAAKJ,MAAf,CAAJ,EAA4B;YACtB,qBAAJ,EAA2BI,IAA3B;;aAEK,KAAKJ,MAAL,CAAYI,IAAZ,KAAqB,EAA5B;;;;gCAGUD,UAAU;;;UACdE,SAASF,SAASG,MAAT,GAAkB,CAAlB,GAAyBH,QAAzB,UAAwC,EAAvD;;aAEO,UAACI,GAAD,EAAMC,GAAN,EAAc;YACbJ,YAAUC,MAAV,GAAmBG,GAAzB;;YAEIA,IAAIC,UAAJ,CAAe,GAAf,CAAJ,EAAyB;cACnBC,OAAJ,CAAYC,IAAZ,CAAiBH,IAAII,KAAJ,CAAU,CAAV,CAAjB;SADF,MAEO;cACDC,MAAJ,CAAWF,IAAX,CAAgB,MAAKG,OAAL,CAAaV,IAAb,CAAhB;;;eAGKG,GAAP;OATF;;;;gCAakC;2BAA5BN,IAA4B;UAA5BA,IAA4B,6BAArB,EAAqB;+BAAjBE,QAAiB;UAAjBA,QAAiB,iCAAN,EAAM;;oBACNf,IAAA,CAC1BU,SAASiB,cADiB,EAE1BlB,WAF0B,EAG1BT,MAAA,CAAS,KAAK4B,WAAL,CAAiBb,QAAjB,CAAT,EAAqC;iBAC1B,EAD0B;gBAE3B,CAAC,KAAKW,OAAL,CAAaX,QAAb,CAAD;OAFV,CAH0B,EAO1BF,IAP0B,CADM;UAC1BS,OAD0B,WAC1BA,OAD0B;UACjBG,MADiB,WACjBA,MADiB;;aAU3BhB,YAAYa,QAAQO,MAAR,CAAeJ,MAAf,CAAZ,EAAoCK,IAApC,CAAyC,GAAzC,CAAP;;;;;;;AAIJpB,SAASiB,cAAT,GAA0B3B,KAAA,CACxBA,IAAA,CAAO,CACL,CAACD,KAAGO,MAAH,CAAD,EAAaN,QAAb,CADK,EAEL,CAACI,QAAD,EAAWJ,IAAA,CAAOA,QAAP,EAAmBA,KAAA,CAAQ,UAAUkB,MAAlB,EAA0B,CAAC,CAA3B,CAAnB,CAAX,CAFK,EAGL,CAACnB,KAAGgC,KAAH,CAAD,EAAY/B,QAAZ,CAHK,EAIL,CAACD,KAAGiC,MAAH,CAAD,EAAahC,IAAA,CAAOA,MAAA,CAASA,QAAT,CAAP,EAA6BA,IAA7B,CAAb,CAJK,CAAP,CADwB,CAA1B;;AASAU,SAASoB,IAAT,GAAgB9B,OAAA,CACdA,IAAA,CAAOU,SAASiB,cAAhB,EAAgClB,WAAhC,EAA6CT,IAAA,CAAO,GAAP,CAA7C,CADc,CAAhB;;;;"}